<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Turn-Based Gunslinger Prototype</title>
  <style>
    body { background:#111; color:#eee; font-family:monospace; }
    canvas { background:#222; display:block; margin:0 auto; }
    #log { width:600px; margin:10px auto; background:#000; padding:10px; height:120px; overflow-y:auto; }
  </style>
</head>
<body>
<canvas id="game" width="600" height="600"></canvas>
<div id="log"></div>
<script>
/* -----------------------------------------------------------
   TURN-BASED GUNSLINGER PROTOTYPE (very small & readable)
   ----------------------------------------------------------- */
const ctx = document.getElementById("game").getContext("2d");
const log  = document.getElementById("log");
function logMsg(t){ log.innerHTML += t+"<br>"; log.scrollTop=999999; }

/* -----------------------------------------------------------
   Basic State
----------------------------------------------------------- */
const State = {
  turn: 0,
  player: { x:300, y:500, hp:10, dmg:3 },
  enemies: [],
  enemyAttackPreview: [], // list of {x,y}
  phase: "player", // "player" or "enemy"
};

/* -----------------------------------------------------------
   Helpers
----------------------------------------------------------- */
function dist(a,b){ return Math.hypot(a.x-b.x,a.y-b.y); }
function draw(){
  ctx.clearRect(0,0,600,600);

  // Draw preview attack tiles
  for(const p of State.enemyAttackPreview){
    ctx.fillStyle = "#662222";
    ctx.beginPath();
    ctx.arc(p.x, p.y, 20, 0, Math.PI*2);
    ctx.fill();
  }

  // Player
  ctx.fillStyle = "#4af";
  ctx.beginPath();
  ctx.arc(State.player.x, State.player.y, 20, 0, Math.PI*2);
  ctx.fill();

  // Enemies
  ctx.fillStyle = "#f44";
  for(const e of State.enemies){
    ctx.beginPath();
    ctx.arc(e.x, e.y, 20, 0, Math.PI*2);
    ctx.fill();
  }
}

/* -----------------------------------------------------------
   Enemy Spawn + Attack Preview
----------------------------------------------------------- */
function spawnWave(){
  State.enemies.push(
    { x:150, y:150, hp:3, dmg:2 },
    { x:450, y:150, hp:3, dmg:2 }
  );
  logMsg("New enemies appear.");
  computeEnemyPreview();
}

function computeEnemyPreview(){
  State.enemyAttackPreview = State.enemies.map(e=>({ x:e.x, y:e.y+60 }));
}

/* -----------------------------------------------------------
   Turns
----------------------------------------------------------- */
function playerAttack(){
  const t = State.player;
  // choose closest enemy
  let closest=null, cd=999;
  for(const e of State.enemies){
    const d=dist(t,e); if(d<cd){ cd=d; closest=e; }
  }
  if(!closest){ logMsg("No enemies to shoot."); return; }
  closest.hp -= t.dmg;
  logMsg("You shoot an enemy for "+t.dmg+" dmg.");
  State.enemies = State.enemies.filter(e=>e.hp>0);
}

function enemyTurn(){
  logMsg("Enemies attack!");
  for(const p of State.enemyAttackPreview){
    if(dist(p, State.player) < 25){
      State.player.hp -= 2;
      logMsg("You are hit for 2 dmg!");
    }
  }
  computeEnemyPreview();
}

function nextTurn(){
  if(State.phase === "player"){
    playerAttack();
    State.phase = "enemy";
  } else {
    enemyTurn();
    State.phase = "player";
  }
  State.turn++;
  draw();
  checkEnd();
}

function checkEnd(){
  if(State.player.hp <= 0){ logMsg("You died."); }
  if(State.enemies.length === 0){ logMsg("Wave cleared!"); spawnWave(); }
}

/* -----------------------------------------------------------
   Input: Player moves with click, attacks with SPACE
----------------------------------------------------------- */
canvas.addEventListener("click", e=>{
  if(State.phase !== "player") return;
  const r = canvas.getBoundingClientRect();
  State.player.x = e.clientX - r.left;
  State.player.y = e.clientY - r.top;
  logMsg("You move.");
  nextTurn();
});

document.addEventListener("keydown", e=>{
  if(e.code === "Space" && State.phase === "player"){
    logMsg("You attack.");
    nextTurn();
  }
});

/* -----------------------------------------------------------
   Start
----------------------------------------------------------- */
spawnWave();
draw();
</script>
</body>
</html>
